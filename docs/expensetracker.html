<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expense Tracker - Stellar Aura</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap" rel="stylesheet">
    <!-- GSAP for animations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0a0a0a;
            color: #f0f0f0;
        }
        .glassmorphism {
            background: rgba(10, 10, 10, 0.25);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* --- Masonry Styles --- */
        #expense-masonry-container {
            position: relative;
            width: 100%;
            margin: 0 auto;
        }
        .masonry-item-wrapper {
            position: absolute;
            box-sizing: border-box;
            padding: 8px;
            cursor: pointer;
        }
        .masonry-item {
            position: relative;
            width: 100%;
            height: 100%;
            padding: 1rem;
            border-radius: 8px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            color: white;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        
        /* --- Dock Styles --- */
        #dock-container {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: flex-end;
            height: 100px;
            padding-bottom: 1rem;
            z-index: 50;
            pointer-events: none;
        }
        #dock {
            display: flex;
            align-items: flex-end;
            gap: 1rem;
            padding: 0.5rem;
            background-color: rgba(10, 10, 10, 0.5);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1rem;
            pointer-events: auto;
        }
        .dock-item {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            background-color: #060010;
            border: 1px solid #222;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            cursor: pointer;
            outline: none;
            transition: width 0.1s ease-out, height 0.1s ease-out;
            color: white;
        }
        .dock-item svg {
            width: 60%;
            height: 60%;
            transition: transform 0.2s;
        }
        .dock-item:hover svg {
            transform: scale(1.1);
        }
        .dock-label {
            position: absolute;
            top: -2rem;
            left: 50%;
            transform: translateX(-50%);
            width: fit-content;
            white-space: nowrap;
            border-radius: 0.375rem;
            border: 1px solid #222;
            background-color: #060010;
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
            color: #fff;
            opacity: 0;
            transition: opacity 0.2s, transform 0.2s;
            pointer-events: none;
        }
        .dock-item:hover .dock-label {
            opacity: 1;
            transform: translateX(-50%) translateY(-5px);
        }
    </style>
</head>
<body class="antialiased">

    <!-- Header Navigation -->
    <header class="sticky top-0 left-0 right-0 z-20 glassmorphism">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="./index.html" class="text-2xl font-bold tracking-wider text-white">
                VISHESH
            </a>
        </nav>
    </header>

    <main class="container mx-auto mt-12 p-4">
        <div id="app-content">
            <h1 class="text-4xl font-bold mb-8 text-center">Expense Tracker</h1>

            <!-- Add Expense Form -->
            <div class="glassmorphism p-8 rounded-lg shadow-lg max-w-2xl mx-auto mb-12">
                <h2 class="text-2xl font-bold mb-6">Add a New Expense</h2>
                <form id="add-expense-form">
                    <div class="mb-4">
                        <label for="expense-description" class="block text-gray-400 mb-2">Description</label>
                        <input type="text" id="expense-description" class="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="e.g., Coffee, Groceries" required>
                    </div>
                    <div class="mb-4">
                        <label for="expense-amount" class="block text-gray-400 mb-2">Amount (₹)</label>
                        <input type="number" id="expense-amount" class="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="e.g., 150" step="0.01" required>
                    </div>
                    <div class="mb-6">
                        <label for="expense-date" class="block text-gray-400 mb-2">Date</label>
                        <input type="date" id="expense-date" class="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300">Add Expense</button>
                </form>
            </div>

            <!-- Expense Masonry Grid -->
            <div>
                <h2 class="text-3xl font-bold mb-6 text-center">All Expenses</h2>
                <div id="expense-masonry-container">
                    <!-- Masonry items will be dynamically added here -->
                </div>
                 <p id="no-expenses-message" class="text-center text-gray-400">No expenses found. Add one above!</p>
            </div>
        </div>
    </main>
    
    <!-- Dock Navigation -->
    <div id="dock-container">
        <div id="dock">
            <!-- Dock items will be dynamically inserted here -->
        </div>
    </div>

    <!-- Non-module script for visuals that don't depend on external imports -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DOCK LOGIC ---
            const dock = document.getElementById('dock');
            const dockContainer = document.getElementById('dock-container');
            const baseItemSize = 50;
            const magnification = 70;
            const distance = 150;
            let itemCenters = [];

            function updateItemCenters() {
                itemCenters = [];
                const items = dock.children;
                for (let i = 0; i < items.length; i++) {
                    const item = items[i];
                    itemCenters[i] = item.offsetLeft + baseItemSize / 2;
                }
            }

            function renderDock(items) {
                dock.innerHTML = ''; 
                itemCenters = []; 
                items.forEach((itemData) => {
                    const dockItem = document.createElement('a');
                    dockItem.href = itemData.href;
                    dockItem.className = 'dock-item';
                    dockItem.style.width = `${baseItemSize}px`;
                    dockItem.style.height = `${baseItemSize}px`;
                    dockItem.innerHTML = itemData.icon;
                    const label = document.createElement('div');
                    label.className = 'dock-label';
                    label.textContent = itemData.label;
                    dockItem.appendChild(label);
                    dock.appendChild(dockItem);
                });
                requestAnimationFrame(updateItemCenters);
            }

            const dockItems = [
                { label: 'Home', href: './index.html', icon: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25" /></svg>` },
                { label: 'Projects', href: '#', icon: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456Z" /></svg>` },
                { label: 'Contact', href: '#', icon: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M21.75 6.75v10.5a2.25 2.25 0 0 1-2.25 2.25h-15a2.25 2.25 0 0 1-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25m19.5 0v.243a2.25 2.25 0 0 1-1.07 1.916l-7.5 4.615a2.25 2.25 0 0 1-2.36 0L3.32 8.91a2.25 2.25 0 0 1-1.07-1.916V6.75" /></svg>` },
            ];
            renderDock(dockItems);
            
            dockContainer.addEventListener('mousemove', e => {
                const dockRect = dock.getBoundingClientRect();
                const mouseX = e.clientX - dockRect.left;
                itemCenters.forEach((center, i) => {
                    const item = dock.children[i];
                    if (!item) return;
                    const dist = Math.abs(mouseX - center);
                    let scale = 0;
                    if (dist < distance) {
                        scale = (Math.cos(dist / distance * Math.PI) + 1) / 2;
                    }
                    const newSize = baseItemSize + (magnification - baseItemSize) * scale;
                    item.style.width = `${newSize}px`;
                    item.style.height = `${newSize}px`;
                });
            });

            dockContainer.addEventListener('mouseleave', () => {
                const items = dock.children;
                for (let i = 0; i < items.length; i++) {
                    const item = items[i];
                    item.style.width = `${baseItemSize}px`;
                    item.style.height = `${baseItemSize}px`;
                }
            });
            
            window.addEventListener('resize', () => setTimeout(updateItemCenters, 100));
        });
    </script>


    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, addDoc, query, onSnapshot, doc, deleteDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const addExpenseForm = document.getElementById('add-expense-form');
        const noExpensesMessage = document.getElementById('no-expenses-message');
        const masonryContainer = document.getElementById('expense-masonry-container');

        // --- MASONRY LOGIC ---
        let hasMounted = false;
        let lastGrid = [];

        function getResponsiveColumnCount() {
            if (window.innerWidth >= 1500) return 5;
            if (window.innerWidth >= 1000) return 4;
            if (window.innerWidth >= 600) return 3;
            if (window.innerWidth >= 400) return 2;
            return 1;
        }

        function calculateGrid(items) {
            const columns = getResponsiveColumnCount();
            const containerWidth = masonryContainer.offsetWidth;
            if (!containerWidth) return [];

            const colHeights = new Array(columns).fill(0);
            const columnWidth = containerWidth / columns;

            return items.map((item) => {
                const col = colHeights.indexOf(Math.min(...colHeights));
                const x = columnWidth * col;
                const height = Math.max(150, Math.min(400, item.amount * 2)); 
                const y = colHeights[col];
                colHeights[col] += height + 16; 

                return { ...item, x, y, w: columnWidth, h: height };
            });
        }

        function animateGrid(grid) {
            const stagger = 0.05;
            const duration = 0.6;
            const ease = "power3.out";

            grid.forEach((item, index) => {
                const selector = `[data-id="${item.id}"]`;
                const animationProps = { x: item.x, y: item.y, width: item.w, height: item.h + 16 };

                if (!hasMounted) {
                    gsap.fromTo(selector, 
                        { opacity: 0, y: window.innerHeight + 200, filter: "blur(10px)" }, 
                        { opacity: 1, ...animationProps, filter: "blur(0px)", duration: 0.8, ease, delay: index * stagger }
                    );
                } else {
                    gsap.to(selector, { ...animationProps, duration, ease, overwrite: "auto" });
                }
            });
            hasMounted = true;
            masonryContainer.style.height = `${Math.max(...grid.map(item => item.y + item.h + 16))}px`;
            lastGrid = grid;
        }

        function renderExpensesAsMasonry(expenses) {
            if (expenses.length === 0) {
                masonryContainer.innerHTML = '';
                noExpensesMessage.classList.remove('hidden');
                return;
            }
            noExpensesMessage.classList.add('hidden');

            const stringToColor = (str) => {
                let hash = 0;
                for (let i = 0; i < str.length; i++) {
                    hash = str.charCodeAt(i) + ((hash << 5) - hash);
                }
                let color = '#';
                for (let i = 0; i < 3; i++) {
                    let value = (hash >> (i * 8)) & 0xFF;
                    color += ('00' + value.toString(16)).substr(-2);
                }
                return color;
            };

            masonryContainer.innerHTML = expenses.map(expense => {
                const color1 = stringToColor(expense.description);
                const color2 = stringToColor(expense.date);
                return `
                    <div class="masonry-item-wrapper" data-id="${expense.id}">
                        <div class="masonry-item" style="background: linear-gradient(45deg, ${color1}99, ${color2}99);">
                            <div>
                                <p class="font-bold text-xl">${expense.description}</p>
                                <p class="text-sm opacity-80">${new Date(expense.date).toLocaleDateString()}</p>
                            </div>
                            <p class="font-black text-4xl text-right">₹${expense.amount.toFixed(2)}</p>
                        </div>
                    </div>
                `;
            }).join('');

            const grid = calculateGrid(expenses);
            animateGrid(grid);
        }

        window.addEventListener('resize', () => {
             if(lastGrid.length > 0) {
                const newGrid = calculateGrid(lastGrid);
                animateGrid(newGrid);
             }
        });

        // --- FIREBASE LOGIC (SIMPLIFIED) ---

        document.getElementById('expense-date').valueAsDate = new Date();

        addExpenseForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const description = document.getElementById('expense-description').value;
            const amount = parseFloat(document.getElementById('expense-amount').value);
            const date = document.getElementById('expense-date').value;
            try {
                await addDoc(collection(db, "expenses"), {
                    description, amount, date, createdAt: serverTimestamp()
                });
                addExpenseForm.reset();
                document.getElementById('expense-date').valueAsDate = new Date();
            } catch (error) {
                console.error("Error adding document: ", error);
            }
        });

        function fetchExpenses() {
            const q = query(collection(db, "expenses"));
            onSnapshot(q, (querySnapshot) => {
                const expenses = [];
                querySnapshot.forEach((doc) => {
                    expenses.push({ id: doc.id, ...doc.data() });
                });
                expenses.sort((a, b) => new Date(b.date) - new Date(a.date));
                renderExpensesAsMasonry(expenses);
            });
        }

        fetchExpenses();

        masonryContainer.addEventListener('click', async (e) => {
            const itemWrapper = e.target.closest('.masonry-item-wrapper');
            if (itemWrapper) {
                const docId = itemWrapper.getAttribute('data-id');
                if (confirm('Are you sure you want to delete this expense?')) {
                    try {
                        gsap.to(itemWrapper, { opacity: 0, scale: 0.8, duration: 0.3, onComplete: async () => {
                            await deleteDoc(doc(db, "expenses", docId));
                        }});
                    } catch (error) {
                        console.error("Error removing document: ", error);
                    }
                }
            }
        });

    </script>
</body>
</html>
